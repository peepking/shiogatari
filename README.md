# 潮語り航海録（β版）

## 概要

海を信仰する旅人「潮語り」として、マップ探索・取引・依頼・神託を通じて航海録を積み重ねるTRPG風シミュレーションです。  
村や街に入り、物資や船、部隊を整えながら日々を進めます。  
戦闘要素ついては現在検討中です。

## 動作環境

- Chrome / Edge / Firefox
- ES Modules対応ブラウザ
- ローカルサーバ（Live Server等）での起動を推奨

## 起動方法

### ローカルで起動

1. 本リポジトリをローカルに配置
2. `index.html` をローカルサーバで起動
3. ブラウザで表示

### Github.ioで起動

以下URLにアクセス  
https://peepking.github.io/shiogatari/

## 画面構成

- 左列: 資産カード（船/部隊/信仰/物資/資金/名声）、ログ、ログ操作
- 中央: マップ、モードカード（行動ボタン）、ガイド/ヘルプ
- 右列: 依頼一覧、勢力シート/貴族一覧

## 基本操作

- マップはホバーで詳細表示、クリックで選択
- 選択中のマスをもう一度クリックすると行動
  - 現在地なら1日待機
  - 隣接（上下左右1マス）なら移動
- 村/街の中にいる間は移動できません。出てから移動してください
- 物資/部隊が上限超過の場合は移動できません（破棄/解雇が必要）

## 村・街

- 現在地が村/街の場合「入る」ボタンが表示
- 入るとモードが「村の中/街の中」に切り替わります
- 「出る」ボタンで通常モードに戻ります

## 取引

### 物資取引（村/街）

- 在庫がある品目、または所持している品目のみ表示
- 需要度に基づく価格で購入/売却
- 資金変動を確認し「取引を確定」で反映

### 船取引（街のみ）

- 1隻5000資金で購入/売却
- 取引前に確認ダイアログあり
- 船数に応じて物資/部隊の上限が増加

## 部隊員雇用

- 村/街で「部隊員雇用」から実行
- 村は2枠、街は4枠の雇用枠が固定で設定
- 1枠につき3人まで雇用可能
- 雇用枠は季節更新で補充
- 雇用レベルはLv1固定

## 依頼

- 村/街で「依頼受注」から受注
- 拠点ごとに季節ごと3件生成
- 受注した依頼は依頼一覧に表示
- 完了条件を満たすと「完了」ボタンで達成
- 期限（30日）を超えると失敗扱いで削除
- 調達依頼/配達依頼の2種類（資金＋名声報酬あり）

## 神託

- 「神託を授かる」で季節に1回のみ受注
- 既存の神託が残っていると新規神託は不可
- 期限は90日
- 種類
  - 糧を捧げよ（加工品の奉納）
  - 動け（海/浅瀬の指定座標に移動）
  - 人身を捧げよ（部隊員の奉納）
- 報酬は信仰

## 海に祈る

- 季節に1回のみ実行可能
- 信仰10以上が必要
- 信仰の10%（切り捨て）を消費し、資金と食料を獲得
- 祈りでは日数は進みません

## 物資/部隊詳細

- 資産カードをクリックすると詳細モーダルを表示
- 物資は破棄、部隊は解雇が可能
- 数量指定後に確認ダイアログで確定

## 戦闘

### 兵種解説

#### 概要

- 歩兵: 標準的な性能。数を集めやすい。
- 衛生兵: 戦線維持役。戦闘には向かないが戦闘後の損耗を抑える。
- 海兵: 浅瀬/海で強い前衛。陸でもそこそこ戦える。
- 弓兵: 長射程の後衛。森/山岳で強いが耐久は低い。
- 斥候: 高機動の遊撃。戦闘には向かないが戦闘前の逃走率を高める。
- 騎兵: 高火力の突撃役。平原で強いが水辺に弱い。
- 弩兵: 長射程高火力。装填が重く足も遅め。
- 盾兵: 高耐久の壁役。森/山で強固。
- 海弓兵: 水辺特化の後衛。浅瀬/海で優位。

#### ステータス

| 兵種 | 雇用費 | 維持費 | HP | ATK | DEF | SPD | RNG | MOV | 平原 | 甲板 | 森 | 山岳 | 浅瀬 | 海 |
| ---- | ---: | ---: | ---: | ---: | ---: | ---: | ---: | ---: | ---: | ---: | ---: | ---: | ---: | ---: |
| 歩兵 | 100 | 2 | 110 | 26 | 18 | 2 | 1 | 1 | 110 | 110 | 120 | 120 | 100 | 100 |
| 衛生兵 | 200 | 4 | 90 | 14 | 10 | 3 | 1 | 1 | 100 | 100 | 100 | 100 | 100 | 100 |
| 海兵 | 150 | 3 | 110 | 28 | 18 | 2 | 1 | 1 | 100 | 100 | 100 | 100 | 120 | 130 |
| 弓兵 | 150 | 3 | 80 | 30 | 8 | 3 | 4 | 1 | 100 | 100 | 120 | 130 | 100 | 100 |
| 斥候 | 100 | 2 | 70 | 18 | 6 | 2 | 2 | 2 | 100 | 100 | 100 | 100 | 100 | 100 |
| 騎兵 | 200 | 4 | 130 | 34 | 18 | 2 | 1 | 2 | 150 | 150 | 100 | 120 | 80 | 80 |
| 弩兵 | 180 | 3 | 85 | 40 | 8 | 4 | 5 | 1 | 110 | 110 | 120 | 120 | 100 | 100 |
| 盾兵 | 150 | 3 | 150 | 26 | 30 | 3 | 1 | 1 | 110 | 110 | 130 | 130 | 90 | 90 |
| 海弓兵 | 170 | 3 | 85 | 30 | 10 | 3 | 4 | 1 | 100 | 100 | 100 | 100 | 120 | 130 |

※消費する食料は兵種による違いはなく、毎季節1日目に部隊員/2を消費。

### 戦闘UIでできること

- 編成カード
  - 自動配備: 待機中の兵を強い順に10部隊まで自動編成
  - クリア: 全員を待機に戻す
  - 手動調整: 兵種ごとにスライダー/数値入力で人数（1部隊10人まで）を指定し「出撃/待機」で移動
  - 適用: 編成を戦闘用に確定（出撃部隊0だと開始できない）
  - 戦闘開始後は編成UIのボタン・入力がすべてロックされ編集不可
- フォーメーションカード
  - テンプレ（バランス/突撃/防御）とカスタムを切替
  - カスタム: 配置更新→戦闘盤面でクリック移動→保存で確定（保存時のみカスタム適用）
  - 選択中ユニットはハイライト、撃破で解除。通常画面でも選択中は強調表示
- 作戦カード
  - 攻撃方針（HP優先/後衛狙い/強敵狙い/近い敵）、距離維持（後退/退避/なし）、突撃抑制（騎兵のみ/全体/なし）、戦闘速度(1x/2x/4x) を設定
- バトル画面
  - ターゲットを簡易エフェクトで可視化、ホバー/選択で部隊詳細をカード表示
  - 戦果報告モーダルで勝敗と内訳（名声/資金/食料/物資/損耗/拿捕/練度上昇）を確認し、地図に戻る

### 戦闘の攻撃方針（兵種基準・作戦で全体上書き可能）

- 近接（歩兵/盾兵/海兵/騎兵/衛生兵/斥候）: HP優先
- 遠隔（弓兵/弩兵/海弓兵）: 後衛狙い（射程>1優先）、次点HP優先
- 作戦カードで「HP優先/後衛狙い/強敵狙い/近い敵」を全体に適用可能
- 探索範囲: 近接3マス / 遠隔4マス。ターゲット切替は粘着気味（切替クールダウンあり）
- マップサイズ: 戦闘マップは10×10固定
- 距離維持（作戦カード）:
  - 後退: 遠隔は射程内を維持するよう1歩後退、近接もHP閾値（デフォ30%）未満で有利地形へ1歩退避
  - 退避: 後退と同様にHP閾値で退避（遠隔は後退も試行）
  - なし: 距離維持を行わない（退避もしない）
- 突撃抑制（作戦カード）:
  - 騎兵のみ/全体/なし を選択可。抑制オンのユニットは味方先頭より2マス以上先行しそうな場合、移動を1歩に抑える

### 遭遇・討伐・神託

- エンカウント: 移動で10〜15マスごとに蓄積、街/村に入場するとリセット
- 戦闘準備モード: 戦闘/逃走/海に祈る/降伏を選択（準備中は通常行動不可）
- 討伐（依頼/神託/賞金首/海賊討伐）
  - 指定座標（距離3〜7の非拠点）に到達するとモードカードに「討伐」ボタンが出現
  - 討伐ボタンで即戦闘開始（逃走不可）。勝利で達成、敗北で失敗
  - 賞金首/強編成は名声100以上で発生、敵は強プールから
- 戦闘後: 戦果報告モーダルで報酬/損耗/拿捕/練度上昇を確認

## ログ・通知

- 行動ログは左列に時系列で記録
- 「ログにメモ」でメモ追加、「ログを書き出す」で書き出し
- 重要イベントはトースト通知で表示

## 勢力・貴族

- 勢力カードをクリックすると貴族一覧が表示
- 貴族をクリックすると保有拠点や特産などの情報を表示

## ガイド/ヘルプ

- ルール要約・世界観・最終航海はガイドカードから確認

## デバッグ

- 「状態手動上書き」モーダルで船/信仰/資金/名声を上書き
- 「リセット」で状態とログを初期化

## 素材提供
 
 - https://lapizwcg.itch.io/
 
