# 潮語り航海録（β版）

## 概要

海を信仰する旅人「潮語り」として、マップ探索・取引・依頼・神託を通じて航海録を積み重ねるTRPG風シミュレーションです。  
村や街に入り、物資や船、部隊を整えながら日々を進めます。  
自動戦闘つきのバトルや勢力・貴族システムも実装されています。

## 動作環境

- Chrome / Edge / Firefox
- ES Modules対応ブラウザ
- ローカルサーバ（Live Server等）での起動を推奨

## 起動方法

### ローカルで起動

1. 本リポジトリをローカルに配置
2. `index.html` をローカルサーバで起動
3. ブラウザで表示

### Github.ioで起動

以下URLにアクセス  
https://peepking.github.io/shiogatari/

## UIクイックガイド

- 左列: 資産カード（船/部隊/信仰/物資/資金/名声）をクリックすると詳細モーダルを開き、破棄/解雇などを実行できます。ログカードではメモ入力・書き出し・クリップボードコピーが行えます。
- 中央: マップは全体/拡大を切替え可能で、ピンの表示/非表示もトグルできます。マスを選択するとモードカードが更新され、移動/待機/入場/祈り/戦闘などの行動ボタンが出現します。行動結果は「状況」セレクトと出目（D6入力）を組み合わせて解釈します。
- 右列: 依頼一覧カードで受注/完了確認ができ、折りたたみ切替も可能です。勢力カードから貴族一覧→貴族詳細を辿れます（支持度/特産/保有拠点を表示）。
- モーダル: 取引/船取引/雇用/編成/フォーメーション/作戦/イベント/確認ダイアログはモーダルで表示されます。背景クリックまたは「閉じる」ボタンで閉じられます。
- ヘルプ: ガイド/ヘルプカードから世界観・最終航海の説明、ログ操作系のショートカットにアクセスできます。

## 主な操作フロー（UIベース）

1. マップで目的地を選択  
   - クリックでマス選択、もう一度クリックで移動/待機を実行。移動距離が1マス以内なら即移動、現在地なら1日待機。
2. 村/街に入る  
   - 目的地が拠点なら「入る」ボタンが表示。入場後は「街/村の中」モードになり、取引/雇用/依頼/謁見の各ボタンが有効化されます。
3. 取引・雇用  
   - 「物資取引」で需要度に応じた価格確認→数量入力→「取引を確定」。街では「船取引」で船売買可能。  
   - 「部隊員雇用」で兵種ごとの雇用枠を確認し、数量入力→「雇用を確定」。枠は季節ごとに補充。
4. 依頼と神託  
   - 「依頼受注」で補給/配達を受け、マップのピン表示を確認。完了条件を満たしたら「完了」で報酬獲得。  
   - 「神託を授かる」は季節に1回のみ。達成前に新規神託は受注不可。
5. 日数経過と祈り  
   - 「1日待機」で日を進め、季節の切り替えで維持費処理が走ります。信仰が10以上なら「海に祈る」で資金/食料を獲得（季節に1回）。
6. 遭遇/討伐/戦闘  
   - 移動で蓄積したエンカウントや依頼目的地で「戦闘準備」へ。編成カード→フォーメーションカード→作戦カードの順で設定し「戦闘開始」。結果は戦果報告モーダルで確認し地図に戻ります。
7. ログとメモ  
   - 「ログにメモ」で任意メモを追記し、書き出し/コピーで外部共有。直近出目は資産カード横のセレクト/入力を参照。

## 序盤の進め方

### 1. 神託を授かろう

ゲームスタート時には1000資金しか元手がないため、まずは神託がおすすめ。  
序盤は神託を達成したらすぐ「海に祈る」で資金を得て次の金策につなげよう。  

### 2. 依頼を受けよう

手っ取り早く稼ぐなら討伐依頼を受けよう。  
調達依頼はそのために拠点を往復すると効率が悪いので、所持しているor売っている状態で受注がおすすめ。  
配達依頼はそれ自体を目的にするのはおすすめできない。  
次に解説する交易のついでに達成すると無駄がなくてよい。

### 3. 交易のすすめ

拠点ごとに相場が異なっているため、物資の売買で儲けることができる。  
村は加工品、街は原料が安い傾向にあるが、特産品はその枠にとらわれず安価になりやすい。  
そのため村で仕入れて街で売ると利益を出しやすい。  
特に武具と香辛料は基礎価格が高いので利幅も大きい。  
所持上限や調達依頼を意識しながら物資を集めよう。  

### 4. 部隊を編成しよう

依頼で名声が上がってくると討伐依頼やエンカウント時の敵部隊が強くなる。  
対策として部隊員を雇用して襲撃に備えよう。  
戦闘マップでの部隊は1部隊10人まで編成可能で、  
人数が多いほどステータスがスケールするため最初に雇用する兵種は歩兵と弓兵がおすすめ。  
以下に強力な兵種の組み合わせをピックアップ。  

#### 歩兵or海兵 + 弓兵or海弓兵

前衛後衛を分けてお互いの弱点を補いあう組み合わせ。  
歩兵と弓兵は数が揃えやすいので、序盤は特におすすめ。

#### 盾兵 + 弩兵 + 騎兵

高耐久で敵を受け止め、高火力で攻撃する鉄板の組み合わせ。  
騎兵は左右で展開して敵部隊をかく乱し、正面を盾兵と弩兵で制圧する。  
資金に余裕が出てきたら揃えよう。

### 5. 船を購入しよう

ある程度資金が溜まってきたら船を購入して部隊と物資のキャパシティを上げよう。  
上げずにいると敵の襲撃規模にこちらの部隊が追いつかなくなったり、食料以外の荷物の余裕がなくなってしまう。  
船は街で購入することができ、1隻5000資金と高額になっている。

## 画面構成

- 左列: 資産カード（船/部隊/信仰/物資/資金/名声）、ログ、ログ操作
- 中央: マップ、モードカード（行動ボタン）、ガイド/ヘルプ
- 右列: 依頼一覧、勢力シート/貴族一覧

## 基本操作

- マップは全体/拡大表示を切り替えおよびピンの表示/非表示の切り替えが可能
- マップはホバーで詳細表示、クリックで選択
- 選択中のマスをもう一度クリックすると行動
  - 現在地なら1日待機
  - 隣接（上下左右1マス）なら移動
- 物資/部隊が上限超過の場合は移動できません（破棄/解雇が必要）

## 部隊

- 毎季節1日に部隊員ごとの維持費を一括で支払い、足りなかった場合はランダムで損耗する
- 毎季節10日, 20日, 30日に部隊員/4の食料を消費し、足りなかった場合はランダムで損耗する
- 全兵種の詳細は「[兵種解説](#兵種解説)」参照

## 物資

- 物資には食料と5種類の原料、5種類の高級品が存在する

| 品目名 | 種類 | 基礎価格 |
| ---- | ---- | ---: |
| 食料 | 食料 | 5 |
| 木材 | 原料 | 10 | 
| 石材 | 原料 | 10 |
| 鉄 | 原料 | 20 |
| 繊維 | 原料 | 20 |
| 塩 | 原料 | 30 |
| 香辛料 | 高級品 | 100 |
| 武具 | 高級品 | 100 |
| 織物 | 高級品 | 50 |
| 酒 | 高級品 | 50 |
| なめし革 | 高級品 | 50 |

## 物資/部隊詳細

- 資産カードをクリックすると詳細モーダルを表示
- 物資は破棄、部隊は解雇が可能
- 数量指定後に確認ダイアログで確定

## 村・街

- 現在地が村/街の場合「入る」ボタンが表示
- 入るとモードが「村の中/街の中」に切り替わります
- 「出る」ボタンで通常モードに戻ります

## 取引

### 物資取引（村/街）

- 在庫がある品目、または所持している品目のみ表示
- 需要度に基づく価格で購入/売却
- 資金変動を確認し「取引を確定」で反映
- 毎季節1日に相場が変化する

### 船取引（街のみ）

- 1隻5000資金で購入/売却
- 取引前に確認ダイアログあり
- 船数に応じて物資/部隊の上限が増加

## 部隊員雇用

- 村/街で「部隊員雇用」から実行
- 村は3枠、街は5枠の雇用枠が固定で設定
- 1枠につき3人まで雇用可能
- 雇用枠は季節更新で補充
- 雇用レベルはLv1固定

## 依頼

- 村/街で「依頼受注」から受注
- 拠点ごとに季節ごと3件生成
- 受注した依頼は依頼一覧に表示
- 完了条件を満たすと「完了」ボタンで達成
- 期限（30日）を超えると失敗扱いで削除（神託は90日）
- 種類: 調達/配達を基本に、神託（奉納/移動/部隊奉納/討伐/強敵討伐）、賞金首/海賊討伐、難民護衛、戦時依頼（防衛/襲撃/小競り合い/補給/護衛/封鎖/停戦）、貴族依頼（補給/斥候/警護/避難/兵站/討伐）など
- 依頼を受注するとマップの目的マスにピンが立ち、ホバーまたは選択中に依頼詳細を表示する

## 神託

- 「神託を授かる」で季節に1回のみ受注
- 既存の神託が残っていると新規神託は不可
- 期限は90日
- 種類
  - 糧を捧げよ（加工品の奉納）
  - 動け（海/浅瀬の指定座標に移動）
  - 人身を捧げよ（部隊員の奉納）
  - 奪え（海賊討伐）
  - 越えよ（賞金首討伐）
- 報酬は信仰
- 神託を授かるとマップの目的マスにピンが立ち、ホバーまたは選択中に神託詳細を表示する

## 海に祈る

- 季節に1回のみ実行可能
- 信仰10以上が必要
- 信仰の10%（切り捨て）を消費し、資金と食料を獲得
- 祈りでは日数は進みません

## 戦闘

### 兵種解説

#### 概要

- 歩兵: 標準的な性能。数を集めやすい。
- 衛生兵: 戦線維持役。戦闘には向かないが戦闘後の損耗を抑える。戦闘に参加させなくても効果がある。
- 海兵: 浅瀬/海で強い前衛。陸でもそこそこ戦える。
- 弓兵: 長射程の後衛。森/山岳で強いが耐久は低い。
- 斥候: 高機動の遊撃。戦闘には向かないが戦闘前の逃走率を高める。
- 騎兵: 高火力の突撃役。平原で強いが水辺に弱い。
- 弩兵: 長射程高火力。装填が重く足も遅め。
- 盾兵: 高耐久の壁役。森/山で強固。
- 海弓兵: 水辺特化の後衛。浅瀬/海で優位。

#### ステータス

| 兵種 | 雇用費 | 維持費 | HP | ATK | DEF | SPD | RNG | MOV | 平原 | 甲板 | 森 | 山岳 | 浅瀬 | 海 |
| ---- | ---: | ---: | ---: | ---: | ---: | ---: | ---: | ---: | ---: | ---: | ---: | ---: | ---: | ---: |
| 歩兵 | 100 | 2 | 110 | 26 | 18 | 2 | 1 | 1 | 110 | 110 | 120 | 120 | 100 | 100 |
| 衛生兵 | 200 | 4 | 90 | 14 | 10 | 3 | 1 | 1 | 100 | 100 | 100 | 100 | 100 | 100 |
| 海兵 | 150 | 3 | 120 | 30 | 18 | 2 | 1 | 1 | 120 | 120 | 100 | 100 | 120 | 130 |
| 弓兵 | 150 | 3 | 80 | 30 | 8 | 3 | 4 | 1 | 100 | 100 | 120 | 130 | 100 | 100 |
| 斥候 | 100 | 2 | 70 | 18 | 6 | 2 | 2 | 2 | 100 | 100 | 100 | 100 | 100 | 100 |
| 騎兵 | 200 | 4 | 130 | 32 | 20 | 2 | 1 | 2 | 150 | 150 | 100 | 120 | 80 | 80 |
| 弩兵 | 180 | 3 | 85 | 40 | 8 | 4 | 5 | 1 | 110 | 110 | 120 | 120 | 100 | 100 |
| 盾兵 | 150 | 3 | 150 | 26 | 30 | 3 | 1 | 1 | 110 | 110 | 130 | 130 | 90 | 90 |
| 海弓兵 | 170 | 3 | 90 | 30 | 10 | 3 | 4 | 1 | 120 | 120 | 100 | 100 | 120 | 130 |

### 戦闘UIでできること

- 編成カード
  - 自動配備: 待機中の兵を強い順に20部隊まで自動編成
  - クリア: 全員を待機に戻す
  - 手動調整: 兵種ごとにスライダー/数値入力で人数（1部隊10人まで）を指定し「出撃/待機」で移動
  - 適用: 編成を戦闘用に確定（出撃部隊0だと開始できない）
  - 戦闘開始後は編成UIのボタン・入力がすべてロックされ編集不可
- フォーメーションカード
  - テンプレ（バランス/突撃/防御）とカスタムを切替
  - カスタム: 配置更新→戦闘盤面でクリック移動→保存で確定（保存時のみカスタム適用）
  - 選択中ユニットはハイライト、撃破で解除。通常画面でも選択中は強調表示
- 作戦カード
  - 攻撃方針（HP優先/後衛狙い/強敵狙い/近い敵）、距離維持（後退/退避/なし）、突撃抑制（騎兵のみ/全体/なし）、戦闘速度(1x/2x/4x) を設定
- バトル画面
  - ターゲットを簡易エフェクトで可視化、ホバー/選択で部隊詳細をカード表示
  - 戦果報告モーダルで勝敗と内訳（名声/資金/食料/物資/損耗/拿捕/練度上昇）を確認し、地図に戻る

### 戦闘の攻撃方針（兵種基準・作戦で全体上書き可能）

- 近接（歩兵/盾兵/海兵/騎兵/衛生兵/斥候）: HP優先
- 遠隔（弓兵/弩兵/海弓兵）: 後衛狙い（射程>1優先）、次点HP優先
- 作戦カードで「HP優先/後衛狙い/強敵狙い/近い敵」を全体に適用可能
- 探索範囲: 近接3マス / 遠隔4マス。ターゲット切替は粘着気味（切替クールダウンあり）
- マップサイズ: 戦闘マップは10×10固定
- 距離維持（作戦カード）:
  - 後退: 遠隔は射程内を維持するよう1歩後退、近接もHP閾値（デフォ30%）未満で有利地形へ1歩退避
  - 退避: 後退と同様にHP閾値で退避（遠隔は後退も試行）
  - なし: 距離維持を行わない（退避もしない）
- 突撃抑制（作戦カード）:
  - 騎兵のみ/全体/なし を選択可。抑制オンのユニットは味方先頭より2マス以上先行しそうな場合、移動を1歩に抑える

### 遭遇・討伐・神託

- エンカウント: 移動で10〜15マスごとに蓄積、街/村に入場するとリセット
- 戦闘準備モード: 戦闘/逃走/海に祈る/降伏を選択（準備中は通常行動不可）
- 討伐（依頼/神託/賞金首/海賊討伐）
  - 指定座標（距離3〜7の非拠点）に到達するとモードカードに「討伐」ボタンが出現
  - 討伐ボタンで即戦闘開始（逃走不可）。勝利で達成、敗北で失敗
  - 賞金首/強編成は名声100以上で発生、敵は強プールから
- 戦闘後: 戦果報告モーダルで報酬/損耗/拿捕/練度上昇を確認

## ログ・通知

- 行動ログは左列に時系列で記録
- 「ログにメモ」でメモ追加、「ログを書き出す」で書き出し
- 重要イベントはトースト通知で表示

## 勢力・貴族

- 勢力カードをクリックすると貴族一覧が表示
- 貴族をクリックすると保有拠点や特産などの情報を表示
- 貴族が滞在中の拠点では「謁見する」ボタンが出現。謁見中は賄賂（好感度上げ）、仕官（名誉家臣化・名声100＆好感度閾値）、貴族依頼受注、辞任が行える

## 戦争・前線行動

- プレイヤー勢力が戦争中で、前線拠点にいる場合のみ戦時アクションボタンが表示（防衛/襲撃/小競り合い/補給/護衛/封鎖）
- 戦時アクションは即時で戦況スコアや支持度を変化させる。依頼ベースの戦闘と別に扱われる
- 戦闘結果や依頼達成/失敗も戦況・支持度・好感度に影響する（戦闘結果は戦果報告モーダルに反映）

## ガイド/ヘルプ

- ルール要約・世界観・最終航海はガイドカードから確認

## デバッグ

- 「状態手動上書き」モーダルで船/信仰/資金/名声を上書き
- 「リセット」で状態とログを初期化

## 素材提供
 
 - https://lapizwcg.itch.io/
 
